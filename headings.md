# 見出し

[パラグラフ]
← [目次] →
[横線]

------------------------------------------------------------------------

Markdownの見出しはHTMLの[`<h1>`,`<h2>`,`<h3>`,`<h4>`,`<h5>`,`<h6>`](https://developer.mozilla.org/ja/docs/Web/HTML/Element/Heading_Elements)に対応する。

## 基本文法

- 先頭に見出しレベル(1..6)と同じ個数の`#`(7つ以上はテキストと認識)
- その後にスペース1つ置いてからコンテンツ(タイトル文)
- 前後に[空行]を入れて前後のブロックと識別する(誤認識対策のため推奨)

```markdown
# h1(文書タイトルなど)

## h2(大項目など)

### h3(中項目など)

#### h4(小項目など、以下略)

##### h5

###### h6

####### 通常テキスト
```

> # h1(文書タイトルなど)
> 
> ## h2(大項目など)
> 
> ### h3(中項目など)
> 
> #### h4(小項目など、以下略)
> 
> ##### h5
> 
> ###### h6
> 
> ####### 通常テキスト

コンテンツ(タイトル本文)には任意の[インライン]構文を記述できる。

```markdown
## 文字参照(&copy;), _italic_, ~~取消~~ `code span`

#### [リンク](https://www.example.com/), 自動リンク → https://github.com/

### <sup>上付き</sup>, <sub>下付き</sub>, ルビ(<ruby>倫敦<rt>ロンドン</rt></ruby>)
```

> ## 文字参照(&copy;), _italic_, ~~取消~~ `code span`
> 
> #### [リンク](https://www.example.com/), 自動リンク → https://github.com/
> 
> ### <sup>上付き</sup>, <sub>下付き</sub>, ルビ(<ruby>倫敦<rt>ロンドン</rt></ruby>)

行頭が`#`で始まる通常テキストは[バックスラッシュエスケープ]を用いて識別させる。

```markdown
\## 通常テキスト
```

> \## 通常テキスト

> 実践的な説明はここまで。ここから先はMarkdownの成立と発展の過程に興味がある人向けの補足解説が中心。初学者は読まずに先に進んでよいし、純粋にドキュメント作成のみに興味のある人には不要な知識なのでやはり読む必要はない。

## 詳しい文法規則

見出しに関するMarkdown文法は昔使われていたテキスト文書で見出しを表現する場合の装飾記法が元になっている。当時よく用いられていた記法を2種類示す。

```markdown
# Heading 1 #

## Heading 2 ##

### Heading 3 ###

Heading 1
=========

Heading 2
---------
```

Markdownはこれらの記法をどちらも受け付けるように仕様が作られており、次の通り出力する。

> # Heading 1 #
> 
> ## Heading 2 ##
> 
> ### Heading 3 ###
> 
> Heading 1
> =========
> 
> Heading 2
> ---------

これらはまずMarkdownの祖先にあたる言語で仕様化され、`#`を用いる記法は[ATX]、次行に`---...`や`===...`を用いる記法は[Setext]によるもの。そして後発のMarkdownは両方を取り込みどちらも使えるようになっている。

### 現方式の完全な文法

現方式の文法([ATX]由来)を全てまとめると次の通り。ただしこれらの大部分は旧式の記法への対応であり、今では全て覚える必要はない(冒頭の「[基本文法](#基本文法)」の知識で十分)。

- 行の先頭文字は`#`(→`<h1>`), `##`(→`<h2>`), ... , `######`(→`<h6>`)
  - 手前に3文字までインデント用スペースを挿入可能
- 直後に1個以上のスペースの後にコンテンツ(見出し本文)
  - GFM仕様では間にスペースが必要(除去して出力)
  - コンテンツ中に任意の[インライン]構文を挿入可能
- 行末に「1個以上の空白,1個以上の`#`,0個以上の空白」の順があれば除去
  - [正規表現]で表すと`/\s+#+\s*$/`
- 前後の[空行]は基本的に不要
  - ただし優先度がより高い[ブロック]構文が手前にあると認識されない
    - 誤認識の元になりやすいので付けるべき(不要な[空行]は単に無視するため無害)

末尾の`#`を除去するのは昔のテキスト記法に由来する仕様で、見出し名の末尾に`#`を使う場合は[バックスラッシュエスケープ]を用いれば除去を防止できる。滅多にないケースだが例文を示す。

```markdown
#### 通常の見出し #####

#### 末尾が`#`の見出し \#####
```

> #### 通常の見出し #####
> 
> #### 末尾が`#`の見出し \#####

#### インデントの副作用

先頭インデントは何かと誤認識の原因になりやすく、特に[リスト]の後にインデント付き見出しを配置するとよく問題が発生する。次の例では見出しをトップレベルでスペース2個分インデントしたという解釈で記述したものとする。

```markdown
- リスト

  ### 見出し
```

これを意図通りに出力するMarkdown実装もある。しかしGitHub Markdownはこのインデントを手前のリスト項目の内部を表現するものと認識する(間の[空行]は何個入れても同じ)。

> - リスト
> 
>   ### 見出し

これはMarkdown実装によって結果が異なる典型例で、[Babelmark]を用いた比較確認結果は次の通り。両方の解釈がある。

https://babelmark.github.io/?text=-+リスト%0A%0A++%23%23%23+見出し

しかしそもそも見出しをリスト項目の中に配置するのは(HTML仕様としては可能だが)通常の文書スタイルでは考えられない。また文法上の解釈に問題がある書き方は最初から避けるに越したことはない。

実践的テクニックとして「誤認識されにくい書き方」を覚えるとよい。インデントは使わず、常に上下に空行を入れる事さえ心掛けておけばこのような問題はまず起こらない。

### Setext見出し

[Setext]方式の文法も同様にまとめておく([GFM]仕様書より要約)。ただし今はもう後方互換対応専用の仕様と考えるべき(学習不要)。コード例も示さない([GitHub Docs](https://docs.github.com/ja/get-started/writing-on-github/getting-started-with-writing-and-formatting-on-github/basic-writing-and-formatting-syntax#headings)でも説明から外されている)。

- 基本的に2行で記述(タイトル行と下線行)
- `<h1>`と`<h2>`のみ(`<h3>`以上のレベルには対応していない)
- タイトル行には任意の[インライン]構文を記述可能
- タイトル行は複数行に渡っていてもよい(継続行はインデントで認識)
- タイトル行は空であってはならない
- 下線行は1つ以上の`=`(→`<h1>`)または1つ以上の`-`(→`<h2>`)
    - 行頭に3つまでスペースを挿入可能
    - 行末に任意個のスペースがあってもよい
    - [正規表現]を用いると `/^ {0,3}(?:=+|-+)\s*$/`
- [GFM]仕様では前後に[空行]は不要と書かれているが、経験上入れないと誤認識が多い

> 例えば下線行に`---`を用いる場合、それがSetext見出しの下線か、それとも[横線]かの判定の問題を生じる。それより「誤認識されない書き方」に専念すべきで、結論として「Setext見出しは使わない」のが最も現実的な選択になる(本稿はMarkdown全般の解説なので仕方なく説明しているが読者は覚えなくていい)。

## Markdown実装による仕様の違い

Markdownは実装により細かい文法が異なる(方言が多いことで有名)。見出しに関しても同様で、GitHub以外のサイトで見られるMarkdown文章の中には見出しの記述が異なるものがよく見られるので補足する。

リストの後にインデント付き見出しを配置したケースは上記「[インデントの副作用](#インデントの副作用)」で説明した通りだが、これ以外にも色々ある。例えば[GFM]ベースのMarkdownでは先頭の`#`と見出し本文の間には空白1個以上が必要だが、他のMarkdown処理実装では不要なものも多い。次の例文を考える。

```markdown
##heading
```

[Babelmark]による比較結果は次の通り。スペースが必要な実装と、スペースなしを受け付ける実装の両方がある。

https://babelmark.github.io/?text=%23%23heading

> 実は昔([CommonMark]仕様を取り込む前)のGitHub Markdownも「`#`と本文の間にスペース不要」の仕様だった。GitHub docsからはもう確認できないが、Web上に痕跡がいくつも見つかる。例えばStack Overflowには今でも次のようなページが残っている(冒頭のコード例参照)。
> 
> https://stackoverflow.com/questions/27981247/github-markdown-same-page-link

これもスペースさえ入れておけば全てのMarkdown実装が見出しと認識する。「スペースは必要」とだけ覚えておけば十分で、問題を未然に防ぐことができる。

------------------------------------------------------------------------

[パラグラフ]
← [目次] →
[横線]

[ATX]: https://en.wikipedia.org/wiki/Aaron_Swartz#atx
[Babelmark]: history.md#babelmark
[CommonMark]: history.md#commonmark
[GFM]: github-flabored-markdown.md
[Setext]: https://en.wikipedia.org/wiki/Setext
[インライン]: inlines.md
[バックスラッシュエスケープ]: characters.md#バックスラッシュエスケープ
[パラグラフ]: paragraphs.md
[ブロック]: blocks.md
[リスト]: lists.md
[空行]: characters.md#空行
[正規表現]: https://developer.mozilla.org/ja/docs/Web/JavaScript/Guide/Regular_Expressions
[目次]: index.md
[横線]: horizontal-rules.md
