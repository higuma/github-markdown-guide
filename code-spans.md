# [6.3 Code spans](https://higuma.github.io/github-flabored-markdown/#code-spans)

[6.2 Entity and numeric character references](entity-and-numeric-character-references.md)
← [Table of contents](index.md) →
[6.4 Emphasis and strong emphasis](emphasis-and-strong-emphasis.md)

------------------------------------------------------------------------

## [6.3 Code spans](https://higuma.github.io/github-flabored-markdown/#code-spans)

コードスパンは[インライン]構文中のコードを表現する。

## Best practice

コードスパンはバックティック(`` ` ``)を用いて`` `code` ``のように表現する。

```markdown
DOMのグローバルオブジェクトは`window`で参照する。
```

> DOMのグローバルオブジェクトは`window`で参照する。

コードスパン内に連続でない`` ` ``が含まれる場合は次のシーケンスを用いる。最初と最後のスペースは処理時に除去される。

* 開始は``` ``  ```&nbsp;(バックティック2個の後にスペース)
* 連続でない`` ` ``を含むコード
* 終了は```  `` ```&nbsp;(スペースの後にバックティック2個)

```markdown
シェルスクリプトのコマンド置換は`` `コマンド` ``で記述する(例: `` echo `ps` ``)。
```

> シェルスクリプトのコマンド置換は`` `コマンド` ``で記述する(例: `` echo `ps` ``)。

連続する`` ` ``を含む場合は次の記法がお勧め。

* 開始は```` ```  ````&nbsp;(内部の連続バックティックより多い個数の後にスペース)
* 連続する``` `` ```を含むコード (本例では2つ連続とする)
* 終了は````  ``` ````&nbsp;(スペースの後に開始と同じ数のバックティック)

```markdown
GFMではコードスパンを``` `` echo `ps` `` ```のように記述できる。
```

> GFMではコードスパンを``` `` echo `ps` `` ```のように記述できる。

## Summary

コードスパンは`` `...` ``で表現する。内部のコードでは[バックスラッシュエスケープ]や[文字参照]、またMarkdownの書式設定が全て無効になる、またHTMLで文字参照を用いる必要のある文字は自動的に変換を行い、HTMLの`<code>...</code>`の中に入れて出力する。

* 開始: 1個以上の連続バックティック
* 0個以上のスペース
* コード記述
    * 特殊記号(`<`,`>`など)は自動的に文字参照に変換してHTML出力
    * 開始と同じ個数の連続バックティックを含んではならない(そこで終了と判定される)
* 0個以上のスペース
* 終了: 開始と同じ個数の連続バックティック

コードを`` `...` ``で囲むのが基本。内部の特殊文字は全て文字参照に変換してHTMLに出力する(自分で処理する必要なし)。次の例では内部に`\`,`<`.`>`などを使っているが、これらはみな適切に変換されて文字通りのHTML出力を得られる。

```markdown
ソースコードの例(C): `printf("\"x = %5.2f\"\n", x);`

HTMLコードの例: `<a href="#">リンク</a>`
```

> ソースコードの例(C): `printf("\"x = %5.2f\"\n", x);`
> 
> HTMLコードの例: `<a href="#">リンク</a>`

開始/終了は1個以上の連続するバックティックを用いる。バックティックの連続個数で開始/終了を判定するため、コードスパン内部にバックティックがある場合は、その連続数と異なる連続バックティックを開始/終了に用いる。次のように内部で使っている最大連続数より多い数を用いれば間違いない。

```markdown
```foo(`bar`, ``baz``)```
```

> ```foo(`bar`, ``baz``)```

逆に内部には連続する` `` `や` ``` `はあるが`` ` ``はない場合は外側に`` ` ``を使える(異なる連続数であればよい)。

```markdown
`foo(``bar``, ```baz```)`
```

> `foo(``bar``, ```baz```)`

コードスパンの先頭と末尾の両方にスペースがある場合は1対だけ除去してから処理する。2個以上の場合は前後1個ずつだけ除去する。どちらか一方だけの場合は除去しない。

```
` foo ` → <code>foo</code>
`  foo   ` → <code> foo  </code>
`foo ` → <code>foo </code>
` foo` → <code> foo</code>
```

> これらはMarkdown処理実装が生成するHTML出力であり、HTMLの表示出力結果とは異なることに注意。HTML側のレンダリング処理はもっと複雑で、この後の [HTMLレンダリング処理での空白の縮約と除去](#HTMLレンダリング処理での空白の縮約と除去) で詳しく解説する。

このルールを用いて最初や最後の文字が`` ` ``である場合を処理できる。次の例では内部に単独の`` ` ``があるため開始/終了は2個連続の` `` `を用いる。処理時はまず先頭と末尾のスペースが一個ずつ取り除かれ、残った文字列`` `command` ``をタグで囲んで``<code>`command`</code>``と出力する。

```markdown
`` `command` ``
```

> `` `command` ``

### HTMLレンダリング処理での空白の縮約と除去

Markdown側では開始直後と終了直前の両方にスペースがあれば1対だけ除去するというルールだけを適用して`<code>...</code>`を出力する。しかしHTMLが`<code>...</code>`をレンダリング処理する際にはより複雑なルールで空白の縮約と除去が行われる。

まずコードスパン内部の連続する空白は全て1個に縮約される。

```markdown
ABC`   foo   bar      baz    `XYZ
```

> ABC`   foo   bar      baz    `XYZ

次にコードスパンの先頭が空白の場合、直前の文字が文頭または空白であればコードスパン先頭の空白が除去される。直前が非空白であれば除去されない。

```markdown
` ←除去される`

ABC ` ←除去される`

ABC` ←除去されない`
```

結果は次の通り。`←`の手前に空白が確保されるかどうかに注意して確認すること。

> ` ←除去される`
> 
> ABC ` ←除去される`
> 
> ABC` ←除去されない`

コードスパン末尾の前後ではコードスパン末尾の空白とコードスパン直後の空白の有無により出力が複雑に変化する。

```markdown
`末尾空白あり、直後に空白のみ(どちらも除去)→ ` 

`末尾空白あり、直後に非空白文字→ `末尾空白は保存

`末尾空白あり、直後に空白の後非空白文字→ ` 末尾空白は保存、直後の空白は除去

`末尾空白なし、直後に空白の後非空白文字→` 直後の空白は保存
```

結果は次の通り。これもコードスパン末尾とその直後の部分のHTML表示に空白が確保されるかどうかという点に注意しながら確認すること。

> `末尾空白あり、直後に空白のみ(どちらも除去)→ ` 
> 
> `末尾空白あり、直後に非空白文字→ `末尾空白は保存
> 
> `末尾空白あり、直後に空白の後非空白文字→ ` 末尾空白は保存、直後の空白は除去
> 
> `末尾空白なし、直後に空白の後非空白文字→` 直後の空白は保存

以上の結果では特にコードスパン直前の空白とコードスパン内の先頭の空白を両方残すことができない点に注意。同様にコードスパン末尾の空白とコードスパン直後の空白を両方残すこともできない。対策はこの次のExamplesで説明する。

## Examples

コードスパン内部では各種書式設定や[文字参照]は使えない(そのまま出力される)が、任意のUnicode文字を直接入力してよい。

```markdown
文字参照は無効 → `M&ouml;tley Cr&uuml;e`

直接入力は可 → `Mötley Crüe`
```

> 文字参照は無効 → `M&ouml;tley Cr&uuml;e`
> 
> 直接入力は可 → `Mötley Crüe`

コードスパンの先頭と末尾の空白は制御が難しく、スペースだけでは次のようなことができない。

* コードスパンの直前とコードスパン内部の先頭の両方に空白を入れる
* コードスパン内部の末尾とコードスパン終了直後の両方に空白を入れる

これらは[ノーブレークスペース]を使って対応できる。コードスパンの直前や直後に`&nbsp;`を挿入すればよい。次のコード例では出力結果のコードスパン内外両方に空白が挿入されていることに注目すること。

```markdown
この空白に注目→&nbsp;`  ←この両端も注目→  `&nbsp;←ここも注目
```

> この空白に注目→&nbsp;`  ←この両端も注目→  `&nbsp;←ここも注目

なおコードスパン内部には文字参照は使えないので`&nbsp;`と書いても機能しない(そのまま出力される)。

```markdown
`&nbsp;&nbsp;&nbsp;-----&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-----&nbsp;&nbsp;&nbsp;`
```

> `&nbsp;&nbsp;&nbsp;-----&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-----&nbsp;&nbsp;&nbsp;`

ただしUnicode文字を直接入力することはできるので、これを利用して縮約されない空白の連続をHTML出力できる。次の例は空白部分にスペース(U+0020)ではなくノーブレークスペース(U+00A0)を入力して作成したもの。

```markdown
`   -----     -----     -----   `
```

> `   -----     -----     -----   `

> ただしこの方法はできれば回避すべき。特にコード断片の表現に用いた場合「内部のコードをコピーペーストしたのに原因不明で動かない」というような問題が発生しやすい。

------------------------------------------------------------------------

[6.2 Entity and numeric character references](entity-and-numeric-character-references.md)
← [Table of contents](index.md) →
[6.4 Emphasis and strong emphasis](emphasis-and-strong-emphasis.md)

[インライン]: inlines.md
[ノーブレークスペース]: https://ja.wikipedia.org/wiki/ノーブレークスペース
[バックスラッシュエスケープ]: backslash-escapes.md
[文字参照]: entity-and-numeric-character-references.md
