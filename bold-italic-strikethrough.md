# 太字、斜体、打ち消し線

[通常テキスト]
← [目次] →
[リンク]

------------------------------------------------------------------------

Markdown標準の表示効果は[太字]、[斜体]、[打ち消し線]の3種類ある。[太字]はHTML要素の[`<strong>`](https://developer.mozilla.org/ja/docs/Web/HTML/Element/strong)、[斜体]は[`<em>`](https://developer.mozilla.org/ja/docs/Web/HTML/Element/em)、打ち消し線は[`<del>`](https://developer.mozilla.org/ja/docs/Web/HTML/Element/del)にそれぞれ変換される。またこれらを組み合わせて太字斜体、打ち消し線付き太字なども表現できる。

> &#x2714;&#xFE0F; 以降の説明(本章の前半)では表示効果対象テキストは前後が行頭・行末または空白文字(スペースなど)で区切られているものとする。区切りなしの場合、境界が句読文字の場合はやや複雑なルールが適用されるため、本章の後半「[太字と斜体の文法認識](#太字と斜体の文法認識)」で詳しく解説する。

## 太字

`**テキスト**`または`__テキスト__`のように表示効果を与える対象テキストの前後を`**`または`__`で囲む。これはHTMLの[`<strong>`](https://developer.mozilla.org/ja/docs/Web/HTML/Element/strong)に変換され、ブラウザ上では太字で表示される。

```markdown
**text テキスト**

__text テキスト__
```

> **text テキスト**
> 
> __text テキスト__

## 斜体

`*text*`または`_text_`のように表示効果を与える対象テキストの前後を`*`または`_`で囲む。これはHTMLの[`<em>`](https://developer.mozilla.org/ja/docs/Web/HTML/Element/em)に変換され、ブラウザ上では斜体で表示される。

```markdown
*text テキスト*

_text テキスト_
```

> *text テキスト*
> 
> _text テキスト_

> &#x26A0;&#xFE0F; **Windows環境向け(重要)**: Windowsではブラウザ表示フォントとして[メイリオ]がよく用いられるが、その場合に斜体がラテン文字領域(記号、英数字、ギリシャ文字、キリル文字等)にだけ有効で、その他の文字(日本語のかなや漢字などを含む)には効かないという有名な問題を生じる。
> 
> > <details>
> > <summary>&#x2714;&#xFE0F; <strong>理由</strong></summary>
> > 
> > > <details>
> > > <summary>&#x2714;&#xFE0F; <strong>フォントの基礎知識</strong></summary>
> > > 
> > > この説明にはまずフォントに関する基礎知識を知っておく必要がある。表示に用いるフォントには標準(Regular)、[斜体]\(Italic)、[太字]\(Bold)の文字種があり、これらの集合で一組のフォントとして扱われる。
> > > 
> > > > &#x2714;&#xFE0F; 実際はもっと複雑で、一般に「斜体」と呼ばれる書体には[イタリック体](https://ja.wikipedia.org/wiki/イタリック体)(Italic)と[オブリーク体](https://ja.wikipedia.org/wiki/斜体)(Oblique)の2種類ある。また字の太さ([ウェイト](https://ja.wikipedia.org/wiki/フォント#ウェイト_(太字フォント・細字フォント)))が豊富に用意されているフォントもある。ただしMarkdownではそこまで細かい設定はできない。以下Markdownで設定可能な上記3種類に限定して説明する。
> > > </details>
> > 
> > > <details>
> > > <summary>&#x2714;&#xFE0F; <strong>ブラウザの処理動作</strong></summary>
> > > 
> > > ブラウザなどのHTML表示環境では[斜体]と[太字]に関してだいたい次のように処理している(概要だがこの程度の理解で十分)。[斜体]の場合を示す([太字]も同様)。
> > > 
> > > 1. 表示用フォントが斜体データを持っている場合はそれを使用する(優先)
> > >    1. 斜体データが表示する文字コードに対応していればそれを出力
> > >    2. 表示する文字コードに対して斜体データが未対応の場合に標準フォントで出力(斜体にならない)
> > > 2. 斜体データを持たないフォントはブラウザ側で斜め変形レンダリングして表示
> > > 
> > > 昔からあるWindows日本語対応フォント(MS Pゴシックなど)は斜体データを持たないため、2番目の方法でブラウザが斜め変形処理して表示するため問題は発生しなかった。
> > > </details>
> > 
> > > <details>
> > > <summary>&#x2714;&#xFE0F; <strong>メイリオで生じる問題</strong></summary>
> > > 
> > > 現行Windows用Webブラウザの多くは[メイリオ]を標準の表示フォントに用いている。[メイリオ]は斜体や太字の専用データを持つが、斜体は不完全でラテン文字領域しかデータが作られていない。そのため日本語文字は上記条件1-2「斜体データが適用されるがその文字コードに対して未対応」に該当し、標準で表示する。
> > > 
> > > > <details>
> > > > <summary>&#x2714;&#xFE0F; <strong>メイリオのフォント仕様</strong></summary>
> > > > 
> > > > メイリオがこのような仕様になった経緯に関しては次を参照。
> > > > 
> > > > https://ja.wikipedia.org/wiki/メイリオ#フォントファミリーの仕様
> > > > 
> > > > しかし理由として書かれている「和文は斜体表記を行う文化的背景がない」はどう考えても言い訳で、昔から広告分野などで日本語の斜体文字は用いられている。実際は工数が膨大で対応困難だったというのが本当の理由だろう。
> > > > </details>
> > > 
> > > 
> > > 現行Windows用ブラウザの多くはインストール時にメイリオを標準表示フォントに設定するため、ユーザーがフォント設定を変更しない限り[`<em>`](https://developer.mozilla.org/ja/docs/Web/HTML/Element/em)や[`<i>`](https://developer.mozilla.org/ja/docs/Web/HTML/Element/i)を設定しても斜体にならない問題が発生する。またメイリオ以外でもブラウザに斜体データが不完全なフォントを設定すると同じ問題が発生する。
> > </details>
> 
> > <details>
> > <summary>&#x2714;&#xFE0F; <strong>有効な対策</strong></summary>
> > 
> > Windowsユーザーの多くはブラウザのフォント設定をわざわざ変えたりしないし、そもそもこういう問題があることを知る人は少ない。Windowsは現行メジャー環境の一つであるため、どのWeb環境のユーザーに対しても同等の表示を保証する場合は「日本語に斜体を使わない」という回避策しか有効な方法はない。
> > </details>
> 
> &#x26A0;&#xFE0F; 以下斜体を用いるコード例には常に英数字を入れ、英数字のみまたは日本語文字(かな、漢字等)との併記を用いる(日本語のみの文例を回避)。表示フォントに[メイリオ]を用いるブラウザでは日本語部分だけ斜体にならないので、その場合は英数字部分を見て効果を判断すること。

## 打ち消し線

`~~text~~`のように表示効果を与える対象テキストの前後を`~~`で囲む。これはHTMLの[`<del>`](https://developer.mozilla.org/ja/docs/Web/HTML/Element/del)に変換され、ブラウザ上では横線を重ねた状態で表示される。

```markdown
~~text テキスト~~
```

> ~~text テキスト~~

## 組み合わせ

[斜体]、[太字]、[打ち消し線]の3つをネストして組み合わせて用いることができる。組み合わせ方法は多数あるがみな同様の表示結果になるため、ここではそれぞれ一番覚えやすそうなものを代表として1種類だけ示す。

### 太字+斜体

```markdown
***bold+italic***
```

> ***bold+italic***

> <details>
> <summary>&#x2714;&#xFE0F; 全ての書き方(全6通り)</summary>
> 
> - `***bold+italic***` → ***bold+italic***
> - `___bold+italic___` → ___bold+italic___
> - `**_bold+italic_**` → **_bold+italic_**
> - `__*bold+italic*__` → __*bold+italic*__
> - `*__bold+italic__*` → *__bold+italic__*
> - `_**bold+italic**_` → _**bold+italic**_

</details>

### 太字+打ち消し線

```markdown
~~**bold+strikeout**~~
```

> ~~**bold+strikeout**~~

> <details>
> <summary>&#x2714;&#xFE0F; 全ての書き方(全4通り)</summary>
> 
> - `**~~bold+strikeout~~**` → **~~bold+strikeout~~**
> - `__~~bold+strikeout~~__` → __~~bold+strikeout~~__
> - `~~**bold+strikeout**~~` → ~~**bold+strikeout**~~
> - `~~__bold+strikeout__~~` → ~~__bold+strikeout__~~
> </details>

### 斜体+打ち消し線

```markdown
~~*italic+strikeout*~~
```

> ~~*italic+strikeout*~~

> <details>
> <summary>&#x2714;&#xFE0F; 全ての書き方(全4通り)</summary>
> 
> - `*~~italic+strikeout~~*` → *~~italic+strikeout~~*
> - `_~~italic+strikeout~~_` → _~~italic+strikeout~~_
> - `~~*italic+strikeout*~~` → ~~*italic+strikeout*~~
> - `~~_italic+strikeout_~~` → ~~_italic+strikeout_~~
> </details>

### 太字+斜体+打ち消し線

```markdown
~~***bold+italic+strikeout***~~
```

> ~~***bold+italic+strikeout***~~

> <details>
> <summary>&#x2714;&#xFE0F; 全ての書き方(全20通り)</summary>
> 
> - `***~~bold+italic+strikeout~~***` → ***~~bold+italic+strikeout~~***
> - `**_~~bold+italic+strikeout~~_**` → **_~~bold+italic+strikeout~~_**
> - `__*~~bold+italic+strikeout~~*__` → __*~~bold+italic+strikeout~~*__
> - `___~~bold+italic+strikeout~~___` → ___~~bold+italic+strikeout~~___
> - `**~~*bold+italic+strikeout*~~**` → **~~*bold+italic+strikeout*~~**
> - `**~~_bold+italic+strikeout_~~**` → **~~_bold+italic+strikeout_~~**
> - `__~~*bold+italic+strikeout*~~__` → __~~*bold+italic+strikeout*~~__
> - `__~~_bold+italic+strikeout_~~__` → __~~_bold+italic+strikeout_~~__
> - `*__~~bold+italic+strikeout~~__*` → *__~~bold+italic+strikeout~~__*
> - `_**~~bold+italic+strikeout~~**_` → _**~~bold+italic+strikeout~~**_
> - `*~~**bold+italic+strikeout**~~*` → *~~**bold+italic+strikeout**~~*
> - `*~~__bold+italic+strikeout__~~*` → *~~__bold+italic+strikeout__~~*
> - `_~~**bold+italic+strikeout**~~_` → _~~**bold+italic+strikeout**~~_
> - `_~~__bold+italic+strikeout__~~_` → _~~__bold+italic+strikeout__~~_
> - `~~***bold+italic+strikeout***~~` → ~~***bold+italic+strikeout***~~
> - `~~**_bold+italic+strikeout_**~~` → ~~**_bold+italic+strikeout_**~~
> - `~~__*bold+italic+strikeout*__~~` → ~~__*bold+italic+strikeout*__~~
> - `~~___bold+italic+strikeout___~~` → ~~___bold+italic+strikeout___~~
> - `~~*__bold+italic+strikeout__*~~` → ~~**_bold+italic+strikeout_**~~
> - `~~_**bold+italic+strikeout**_~~` → ~~_**bold+italic+strikeout**_~~
> </details>

## ネスト

これら3種類の書式は互いに部分的にネストすることも可能で、例えば全体が太字でその中の一部が太字+斜体の場合は次のように書いてよい。

```markdown
**Bold _and italic_**
```

> **Bold _and italic_**

> &#x2714;&#xFE0F; `**Bold *and italic***`等でもよい(組み合わせは4通り)。ただし同じ記号を使うと認識しないMarkdown実装がある(→ [Babelmark](https://babelmark.github.io/?text=**Bold+*and+italic***))。またそれぞれのネスト範囲を明示する意味で記号を分けた方が意味が分かりやすい。

ネスト(入れ子)構造に従っていればどのような組み合わせも可能。

```markdown
**太字で~~さらに取り消し線~~の後で太字に戻る**

_Italic **and bold ~~and strikeout~~** → back to italic_
```

> **太字で~~さらに取り消し線~~の後で太字に戻る**
> 
> _Italic **and bold ~~and strikeout~~** → back to italic_

ただしネストはできてもオーバーラップはできない。次は意図的に作った失敗例で、`**...**`の範囲を太字、`_..._`の範囲を斜体、そして両者の共通部分は斜体+太字に設定しようとしたもの。しかしネスト構造の条件を満たしていないため意図した通りに文法認識してもらえない。

```markdown
**Bold _bold+italic** italic_
```

> **Bold _bold+italic** italic_

正しくは次の通り。ネスト構造に従って記述する必要があるため`bold+italic`の後でいったん書式設定を終了し、その後で`italic`を単独の斜体に設定する。

```markdown
**Bold _bold+italic_** _italic_
```

> **Bold _bold+italic_** _italic_

> <details>
> <summary>&#x2714;&#xFE0F; <strong>全ての書き方(全8通り)</strong></summary>
> 
> - `**Bold *bold+italic*** *italic*` → **Bold *bold+italic*** *italic*
> - `**Bold *bold+italic*** _italic_` → **Bold *bold+italic*** _italic_
> - `**Bold _bold+italic_** *italic*` → **Bold _bold+italic_** *italic*
> - `**Bold _bold+italic_** _italic_` → **Bold _bold+italic_** _italic_
> - `__Bold *bold+italic*__ *italic*` → __Bold *bold+italic*__ *italic*
> - `__Bold *bold+italic*__ _italic_` → __Bold *bold+italic*__ _italic_
> - `__Bold _bold+italic___ *italic*` → __Bold _bold+italic___ *italic*
> - `__Bold _bold+italic___ _italic_` → __Bold _bold+italic___ _italic_
> </details>

## エスケープ

通常テキストの中に`*`,`_`,`~~`が含まれており、表示効果の書式と一致する場合は適宜[バックスラッシュエスケープ]を用いて表示効果ではないことを認識させる。全てをエスケープする必要はなく、文法認識の起点となる[ASCII句読文字]の部分をエスケープすればよい。

```markdown
\*not italic*

\_not italic_

\~~取り消し線ではない~~
```

> \*not italic*
> 
> \_not italic_
> 
> \~~取り消し線ではない~~

> &#x2714;&#xFE0F; **参考**: 代わりに[文字参照]を用いてもよい。ただし[バックスラッシュエスケープ]の方が楽に書ける。
> 
> ```markdown
> &ast;not italic*
> ```
> 
> > &ast;not italic*

ただし太字の場合に注意。エスケープ1つだけでは足りず、残りの部分が斜体と認識される。先頭の2つを両方エスケープしてやっと通常文字と認識される。

```markdown
\**italic surrounded by asterisks**

\__italic surrounded by underscores__

\*\*normal text**

\_\_normal text__
```

> \**italic surrounded by asterisks**
> 
> \__italic surrounded by underscores__
> 
> \*\*normal text**
> 
> \_\_normal text__

太字斜体も同様で、先頭の3つ全てエスケープする必要がある。`*`の場合のみ示す(`_`も同様)。

```markdown
***bold and italic***

\***bold surrounded by asteriks***

\*\**italic surrounded by double-asteriks***

\*\*\*normal text***
```

> ***bold and italic***
> 
> \***bold surrounded by asteriks***
> 
> \*\**italic surrounded by double-asteriks***
> 
> \*\*\*normal text***

> &#x2757;&#xFE0F; **注意**: 以上はGitHub Markdownの動作だが、別のMarkdown実装では詳細動作が異なる場合もある(Babelmarkで確認すると実際にある)。他のMarkdown環境上でも使う可能性がある文章の場合は想定し得る箇所全てをエスケープするとよい(推奨)。

## 適用場所

[インライン]アイテムを挿入可能な場所であればどこにでも記述できる。

```markdown
> _ブロック引用の中_

- **リストの中**

### ***見出しの中***

| *表の中* |
| -------- |
| ~~セル~~ |
```

> > _ブロック引用の中_
> 
> - **リストの中**
> 
> ### ***見出しの中***
> 
> | *表の中* |
> | -------- |
> | ~~セル~~ |

## インラインの挿入

太字・斜体・打ち消し線の内部に各種[インライン]アイテムを挿入できる。次のように文字出力を伴う[インライン]アイテムの多くに効果がある。

- [リンク]
  - 通常リンク: `_[ページ先頭](#)_` → _[ページ先頭](#)_
  - 自動リンク: `**Send to <mailto:nobody.com>.**` → **Send to <mailto:nobody.com>.**
  - 拡張自動リンク: `***See http:://github.com/ later.***` → ***See https://github.com/ later.***
- [HTMLインライン]\(GitHub環境で有効なもの)
  - 上付き文字: `_N<sup>2</sup>_` → _N<sup>2</sup>_
  - 下付き文字: `**NH<sub>3</sub>**` → **NH<sub>3</sub>**
  - 変数: `**<var>y</var> = 2<var>x</var>**` → **<var>y</var> = 2<var>x</var>**
  - ルビ: `___<ruby>海月<rt>くらげ</rt></ruby>___` → ___<ruby>海月<rt>くらげ</rt></ruby>___
  - サンプル出力: `**<samp>logout</samp>**` → **<samp>logout</samp>**
  - 行内引用: `~~<q>引用取り消し</q>~~` → ~~<q>引用取り消し</q>~~

テキストを文字通り出力する目的のアイテムや、テキストではないアイテムには効果はない。

- [コードスパン]: ``**ここは太字、`効果なし`**`` → **ここは太字、`効果なし`**
- [画像]: `_ここは斜体、![](img/arrow-right-circle.svg)_` → _ここは斜体、![](img/arrow-right-circle.svg)_

## 太字と斜体の文法認識

ここから太字と斜体の文法認識ルールについて解説する。なおGFM仕様書の記述は難解で実装者用の内容なので、以下は文書作成者用の実用的な表現に書き換えて説明する。

まず太字や斜体は必ず文字として表示する目的で用いるものであり、強調対象テキストの先頭や末尾は空白であってはならない。次のように間に空白があると認識しない。

- `*a*` → *a* (斜体と認識)
- `**a**` → **a** (太字と認識)
- `* a*` → * a* (認識しない)
- `**a **` → **a ** (認識しない)

文法認識は強調記述文字が`*`の場合と`_`の場合で動作が異なる(`_`の方がやや複雑)。はじめに`*`の場合を示し、その後で`_`の場合を説明する。

### `*`の場合

`*`の場合は基本的に`*...*`の外部に空白がなくても認識する。ただし`*"foo"*`のように強調対象の先頭や末尾が句読文字の場合は境界として空白または句読文字が必要。まず斜体の場合を例文で示す。

1. `a *b* c` → a *b* c (`*b*`を斜体と認識)
2. `a*b*c` → a*b*c (`*`は密着していても認識する)
3. `a*"b"*c` → a*"b"*c (強調対象の先頭や末尾が句読文字の場合は密着すると認識しない)
4. `a *"b"* c` → a *"b"* c (境界を空白で区切れば認識する)
5. `a&shy;*"b"*&shy;c` → a&shy;*"b"*&shy;c ([ソフトハイフン]を用いて認識)

例5の`&shy;`(U+00AD)は[ソフトハイフン]で、[幅0の非表示区切り]としての機能を持ち、斜体認識時は句読文字として扱われる。これを用いて間を空けずに任意の区間に対して斜体設定を行うことができる。

太字の場合は上記の`*`を`**`に置き換えればよい。

1. `a **b** c` → a **b** c (`**b**`を太字と認識)
2. `a**b**c` → a**b**c (`**`は密着していても認識する)
3. `a**"b"**c` → a**"b"**c (強調対象の先頭や末尾が句読文字の場合は密着すると認識しない)
4. `a **"b"** c` → a **"b"** c (境界を空白で区切れば認識する)
5. `a&shy;**"b"**&shy;c` → a&shy;**"b"**&shy;c ([ソフトハイフン]を用いて認識)

### `_`の場合

`_`の場合は密着した場合のルールが異なる。まず斜体の場合。

1. `a _b_ c` → a _b_ c (`_b_`を斜体と認識)
2. `a_b_c` → a_b_c (`_`は密着していると認識しない)
3. `a&shy;_b_&shy;c` → a&shy;_b_&shy;c (密着して認識させるには[ソフトハイフン]を用いる)
4. `a_"b"_c` → a_"b"_c (強調対象の先頭や末尾が句読文字の場合: まず認識しない例)
5. `a _"b"_ c` → a _"b"_ c (境界を空白で区切って認識)
6. `a&shy;_"b"_&shy;c` → a&shy;_"b"_&shy;c ([ソフトハイフン]を用いて認識)

太字の場合。

1. `a __b__ c` → a __b__ c (`__b__`を太字と認識)
2. `a__b__c` → a__b__c (`__`は密着していると認識しない)
3. `a&shy;__b__&shy;c` → a&shy;__b__&shy;c (密着して認識させるには[ソフトハイフン]を用いる)
4. `a__"b"__c` → a__"b"__c (強調対象の先頭や末尾が句読文字の場合: まず認識しない例)
5. `a __"b"__ c` → a __"b"__ c (境界を空白で区切って認識)
6. `a&shy;__"b"__&shy;c` → a&shy;__"b"__&shy;c ([ソフトハイフン]を用いて認識)

### 実用的なまとめ

実用的知識として次の2点を覚えておけばよい。

- 強調対象文字の先頭と末尾は必ず印字文字(空白を入れてはならない)
- 強調区間(`*...*`,`**...**`,`_..._`,`__...__`)の前後境界に空白または句読文字が必要な場合がある
  - スペースを入れてよい場合はそれで認識させる
  - 密着する場合は[幅0の非表示区切り]\(特に[ソフトハイフン]`&shy;`)を用いる

## 太字と斜体の文法認識(実装者用解説)

> &#x26A0;&#xFE0F; ここからは実装者あるいは詳細仕様に興味がある読者のための解説。Markdownで文章を書くのに必要な知識ではない(文書作成目的の読者は読んでも時間の無駄)。

ここからはGFM仕様書に基づいた太字と斜体の認識を解説する。

### 文字の種類


#### Unicode空白(Unicode whitespace)

[GFM仕様書の定義]()は次の通り。

- カテゴリー[Zs(space separator)](https://www.compart.com/en/unicode/category/Zs): スペース(0x20)はここに含まれる
- カテゴリーCcの文字のいくつか: タブ(0x09)、改行(0x0A)、キャリッジリターン(0x0D)

### 区切り文字列(delimiter run)

> 訳語が難しい(ていうか原文が何か的を得ていない!)。直訳は「区切りの連なり」のような感じだが、具体的な意味は「強調認識パターンの起点となるマーカー文字列」。

[GFM仕様書の定義](https://github.github.com/gfm/#delimiter-run)は次の通り。


- エスケープされていない`*`または`_`の連続

### 左右境界区切り文字列(left/right-flanking dellimiter run)

- 区切り文字列であり、さらに次の条件を満たすもの
  - 
- この判定の場合のみ行頭・行末をUnicode空白と同じものと認識する












#### 太字

太字のルールは斜体と同様で、`__`に置き換えればよい。

1. 太字の開始パターンは次のどちらか
   1. 「太字を表す`__`」「単語に用いる文字(空白文字ではなく、句読文字でもない)」
   2. 「空白文字または行頭」「太字を表す`__`」「句読文字」
   3. 「句読文字」「太字を表す`__`」「句読文字」
2. 太字の終了パターンは次のどちらか(開始パターンを反転させたもの)
   1. 「単語に用いる文字(空白文字ではなく、句読文字でもない)」「太字を表す`__`」
   2. 「句読文字」「太字を表す`__`」「空白文字または行頭」
   3. 「句読文字」「太字を表す`__`」「句読文字」

実例も同様。

1. `a __b__ c` → a __b__ c (`__b__`を太字と認識)
   - 開始: `__b`の部分が条件1-1にマッチ
   - 開始: `b__`の部分が条件2-1にマッチ
2. `a__b__c` → a__b__c (`__`の場合は密着していても認識する)
3. `a__ b__c` → a__ b__c (`__`と太字対象文字列の間にスペースがあるためマッチしない)
4. `a__b __c` → a__b __c (同上)
5. `a __"b"__ c` → a __"b"__ c (`"b"`が太字になる)
   - 開始: ` __"`が条件1-2にマッチ
   - 終了: `"__ `が条件2-2にマッチ
6. `a__"b"__c` → a__"b"__c (これではマッチしない)
7. `a&shy;__"b"__&shy;c` → a&shy;__"b"__&shy;c (これでマッチする)
   - 開始: `&shy;__"`の3文字が条件1-3にマッチ
   - 終了: `"__&shy;`の3文字が条件2-3にマッチ

















------------------------------------------------------------------------

`*`で斜体を表現する場合の大まかなルールを箇条書きでまとめる。

1. 斜体の開始パターンは次のいずれか
   1. 「斜体を表す`*`」「単語に用いる文字(空白文字ではなく、句読文字でもない)」
   2. 「空白文字または行頭」「斜体を表す`*`」「句読文字」
   3. 「句読文字」「斜体を表す`*`」「句読文字」
2. 斜体の終了パターンは次のいずれか(開始パターンを反転させたもの)
   1. 「単語に用いる文字(空白文字ではなく、句読文字でもない)」「斜体を表す`*`」
   2. 「句読文字」「斜体を表す`*`」「空白文字または行頭」
   3. 「句読文字」「斜体を表す`*`」「句読文字」

これだけでは分かりにくいので実例を用いて説明する。

1. `a *b* c` → a *b* c (`*b*`を斜体と認識)
   - 開始: `*b`の部分が上記条件1-1にマッチ
   - 開始: `b*`の部分が上記条件2-1にマッチ
2. `a*b*c` → a*b*c (密着していても認識する: マッチ条件は上記1と同じ)
3. `a* b*c` → a* b*c (`*`と斜体対象文字列の間にスペースがあるためマッチしない)
4. `a*b *c` → a*b *c (同上)
5. `a *"b"* c` → a *"b"* c (`"b"`が斜体になる)
   - 開始: ` *"`が条件1-2にマッチ
   - 終了: `"* `が条件2-2にマッチ
6. `a*"b"*c` → a*"b"*c (これではマッチしない)
7. `a&shy;*"b"*&shy;c` → a&shy;*"b"*&shy;c (これでマッチする)
   - 開始: `&shy;*"`の3文字が条件1-3にマッチ
   - 終了: `"*&shy;`の3文字が条件2-3にマッチ

例7の`&shy;`(U+00AD)は[ソフトハイフン]で、幅0で非表示の文字区切りとしての機能を持ち、斜体認識時は句読文字として扱われる。例7はこれを用いた特殊テクニックで、スペースで間を空けずに斜体設定を行うことができる。

#### 太字

太字のルールは斜体と同様で、`**`に置き換えればよい。

1. 太字の開始パターンは次のいずれか
   1. 「太字を表す`**`」「単語に用いる文字(空白文字ではなく、句読文字でもない)」
   2. 「空白文字または行頭」「太字を表す`**`」「句読文字」
   3. 「句読文字」「太字を表す`**`」「句読文字」
2. 太字の終了パターンは次のいずれか(開始パターンを反転させたもの)
   1. 「単語に用いる文字(空白文字ではなく、句読文字でもない)」「太字を表す`**`」
   2. 「句読文字」「太字を表す`**`」「空白文字または行頭」
   3. 「句読文字」「太字を表す`**`」「句読文字」

実例も同様。

1. `a **b** c` → a **b** c (`**b**`を太字と認識)
   - 開始: `**b`の部分が条件1-1にマッチ
   - 開始: `b**`の部分が条件2-1にマッチ
2. `a**b**c` → a**b**c (密着していても認識する: マッチ条件は上記1と同じ)
3. `a** b**c` → a** b**c (`**`と太字対象文字列の間にスペースがあるためマッチしない)
4. `a**b **c` → a**b **c (同上)
5. `a **"b"** c` → a **"b"** c (`"b"`が太字になる)
   - 開始: ` **"`が条件1-2にマッチ
   - 終了: `"** `が条件2-2にマッチ
6. `a**"b"**c` → a**"b"**c (これではマッチしない)
7. `a&shy;**"b"**&shy;c` → a&shy;**"b"**&shy;c (これでマッチする)
   - 開始: `&shy;**"`の3文字が条件1-3にマッチ
   - 終了: `"**&shy;`の3文字が条件2-3にマッチ







- 

異なる規則を用いる。





## 











太字と斜体の文法認識には文字種によるパターンマッチングを用いる。以下GitHub Flavored Markdown仕様書の記述に基づいて説明するが、現実のGitHub実装は明らかにGFM仕様に従っていない部分があるため、この点に付いても補足説明を行う。

### 文字種の分類

まずここで用いる用語をまとめる。

#### **Unicode空白文字**, **非Unicode空白文字**

GFM仕様書の定義によれば次のどちらかに該当する文字を**Unicode空白文字(Unicode punctuation characters\)**と呼び、これを太字と斜体の判定に用いる。

- Unicodeカテゴリ`Zs`に該当する文字(スペースなどの空白文字系は全てこれに該当)
- タブ(U+0009), キャリッジリターン(U+000D), 改行(U+000A)

しかし実際のGitHub実装はカテゴリー[Cf](https://www.compart.com/en/unicode/category/Cf)の文字のいくつかも空白として扱っている。次の文字はどれも「非表示で幅0の空白または区切り」という機能を持ち、実際の間隔を空けずに区切りだけ認識させる場合に時折用いられる。

- [Soft Hyphen (U+00AD, `&shy;`)](https://www.compart.com/en/unicode/U+00AD)
- [Zero Width Space (U+200B, `&ZeroWidthSpace;`)](https://www.compart.com/en/unicode/U+200B)
- [Zero Width Non-Joiner (U+200C, `&zwnj;`)](https://www.compart.com/en/unicode/U+200C)

> <details>
> <summary>調査結果</summary>
> 
> これらに関してはGitHubの実環境チェックを行った。結果は次の通り全て強調を認識した。
> 
> - `abc___pqr___xyz` → abc___pqr___xyz (`_`は前後が単語文字の場合は強調と認識しない)
> - `abc&shy;___pqr___&shy;xyz` → abc&shy;___pqr___&shy;xyz (空白挿入として扱われ認識、以下同様)
> - `abc&#x200B;___pqr___&#x200B;xyz` → abc&#x200B;___pqr___&#x200B;xyz
> - `abc&#x200C;___pqr___&#x200C;xyz` → abc&#x200C;___pqr___&#x200C;xyz
> 
> なお本ケースで使える幅0の非表示文字は他にも多数あり、Zero Width Joiner (U+200D)やInvisible Separator (U+2063)なども認識したが、これ以上は実装者以外には不要な知識なので調査を打ち切る。
> </details>

またGFM仕様書の定義では**Unicde空白文字**以外の全ての文字を**非Unicode空白文字**と呼ぶ。

#### 句読文字

句読文字(Punctuation characters)の定義は次の通り。

- ***p*** = 句読文字(punctuation characters)
  - ASCII句読文字(ASCII punctuation characters), 次のどれかに該当する文字
    - U+0021..U+002F: `!`, `"`,：ｗ `#`, `$`, `%`, `&`, `'`, `(`, `)`, `*`, `+`, `,`, `-`, `.`, `/`
    - U+003A..U+0040: `:`, `;`, `<`, `=`, `>`, `?`, `@`
    - U+005B..U+0060: `[`, `\`, `]`, `^`, `_`, `` ` ``
    - U+007B..U+007E: `{`, `|`, `}`, `~`
  - `P`で始まるUnicodeカテゴリ(`Pc`, `Pd`, `Pe`, `Pf`, `Pi`, `Po`, `Ps`)を持つ文字

#### 単語文字

GFM仕様書の定義によれば単語文字(word characters)とはUnicode空白文字と句読文字を除外した他全ての文字を指す。

ただしこの表現はどう考えても不正確で、



強調記号が`*`の場合と`_`の場合でルールが異なることに注意。まず`*`の場合から示す。

- 斜体の開始は次のいずれかに該当するパターン(`*`の直後から斜体)
  - `*` **単語文字**
    - 例: `**A...`, `*あ...`
  - **空白**または**行頭**  `*` **[句読文字]** **非空白文字**
    - 例: &NoBreak;` *"あ...`, &NoBreak;` *@...`
  - **[句読文字]**  `*` **[句読文字]** **非空白文字**
    - 例: `!*"あ...`, &NoBreak;`:*"...`
- 斜体の終了は次のいずれかに該当するパターン(上記の逆順: `*`の直前まで斜体)
  - **単語文字** `*`
    - 例: `...A*`, `...あ*`
  - **非空白文字** **[句読文字]** `*` **空白**または**行末**  
    - 例: `...あ*" `&NoBreak;, `...@* `&NoBreak;
  - **[句読文字]**  `*` **[句読文字]** **非空白文字**
    - 例: `!*"あ...`, &NoBreak;`:*"...`
- 太字も同様(上記の`*`を全て`**`に置き換えたパターンを適用)






> **TODO**: ここから先を書き直し中。

> &#x2714;&#xFE0F; ここから強調対象テキストが区切られていない場合も含む詳しい文法解説。


太字と斜体の文法認識は英文のように単語をスペースなどの空白文字で区切る文書を想定した仕様になっている。また[GFM]仕様のMarkdownでは書式設定テキスト内に`_`が含まれる場合(特に[スネークケース])を考慮し、`*`と`_`の扱いが非対称な仕様になっている。

### 空白で区切られている場合

設定対象テキストの前後が空白または文頭/文末で区切られている場合の判定条件をパターンとして示す。簡単に言えば書式記号(`*`,`_`,`**`,`__`)の前後にある空白(または文頭/文末)を検出して書式範囲の開始・終了を認識する。

- 開始パターン
  1. 空白または文頭
  2. `*`, `_`, `**`, `__`のいずれか
  3. 非空白文字(書式対象文字列の最初)
- 終了パターン
  1. 非空白文字(書式対象文字列の最後)
  2. `*`, `_`, `**`, `__`のいずれか(開始と同一のもの)
  3. 空白または文末

```markdown
**bold** _italic_ ***bold+italic***
```

> **bold** _italic_ ***bold+italic***

なお`***bold+italic***`のケースは2段階で評価される。まず外側の`*...*`を検出し、その内部を斜体に設定する。次に内側の`**...**`を検出し、その内部を太字に設定する。

> この斜体が太字より優先する仕様は[GFM]仕様書原文で確認した。[Example 425](https://github.github.com/gfm/#example-425)の出力を見ると`<em>`の内側に`<strong>`を生成している。またブラウザの開発ツールで実際の出力を確認しても結果は一致する。ただし実用上は特に知る必要はなくどちらでも構わない(逆でも出力は同等)。

### 密着している場合

対象テキストの前後が空白または文頭/文末でない場合は条件が変化する。

まず**書式記号の前後とも英数字の場合**は`*`だけを認識し、`_`は通常文字扱いでそのまま表示する。このルールにより[スネークケース](例 - `MAX_DATA_SIZE`)を通常テキストとして記述する場合に中間の`_`をエスケープせずそのまま記述できる。

```markdown
abc*123*xyz abc_123_xyz
```

> abc*123*xyz abc_123_xyz

```markdown
123**abc**456 123__abc__456
```

> 123**abc**456 123__abc__456

```markdown
abc***123***xyz abc___123___xyz
```

> abc***123***xyz abc___123___xyz

対象テキスト側の境界(先頭文字と末尾文字)が[句読文字]の場合は書式記号を挟んだ反対側にある外側の境界文字で判定する。外側の境界文字が空白または句読文字であれば書式の境界、それ以外は境界ではないと判定し、前後に同種の境界があればその内部を書式設定範囲とする。

次のコード例は全て内部が

```markdown
前後
```











強調文字列内部の境界文字が英数字ではない句読文字の場合は強調書式の外側の境界文字で判定し、全て空白または句読文字であれば強調書式が適用される。

* `*!Italic!* __(Bold)__ ***"Bold italic"***` → *!Italic!* __(Bold)__ ***"Bold italic"***
* `|*!Italic!*|__(Bold)__|***"Bold italic"***|` → |*!Italic!*|__(Bold)__|***"Bold italic"***|

それ以外(英数字や日本語文字など)が密着していると強調ではないと判定する。以下の例文では手前の文字`0`,`A`,`あ`の後に空白または句読文字がある場合に強調、密着していれば強調ではないと判定していることに注意

* `0 *!italic!* BUT 0*!not!*` → 0 *!italic!* BUT 0*!not!*
* `A-__;bold;__ BUT A__;not;__` → A-__;bold;__ BUT A__;not;__
* `あ ***'bold italic'*** BUT あ***'not'***` → `あ ***'bold italic'*** BUT あ***'not'***

### ネスト

次(Example 378, 382)は斜体(`<em>`)の2重掛けと認識される。同じものを複数回ネストしても1回分と同じで、(CSSを駆使して特殊な設定を行わない限り)全体が斜体になる以上の効果はない。

`*(*foo*)* _(_foo_)_` → *(*foo*)* _(_foo_)_

境界が空白で明確化されている場合は次のように同種の文字を使っても認識する。

* `*italic **bold italic***` → *italic **bold italic***
* `**bold *bold italic***` → **bold *bold italic***

密着している場合は外側に`_`、内側に`*`を用いる。

* `_Italic**Bold italic**Italic_` → _Italic**Bold italic**Italic_
* `__Bold*Bold italic*Bold__` → __Bold*Bold italic*Bold__

> (参考) 逆にするとうまくいかない。次は失敗例。
> 
> * `*Italic__Bold-italic__Italic*` → *Italic__Bold-italic__Italic*
> * `**Bold_Bold-italic_Bold**` → **Bold_Bold-italic_Bold**


### インライン構文の挿入

内部に別のインライン構文を挿入できる。まず次は表示効果も効くもの。

* 打ち消し線
* リンク

文例

* `__bold ~~strikethrough~~__` → __bold ~~strikethrough~~__
* `_italic [link](https:///www.example.com/)_` → _italic [link](https:///www.example.com/)_

挿入はできるが表示効果は効かないもの。

* コードスパン
* 画像

------------------------------------------------------------------------

[通常テキスト]
← [目次] →
[リンク]

[ASCII句読文字]: characters.md#ascii句読文字
[HTMLインライン]: html-inlines.md
[Unicode空白文字]: unicode-whitespace-characters.md
[インライン]: inlines.md
[コードスパン]: code-spans.md
[ソフトハイフン]: https://ja.wikipedia.org/wiki/ソフトハイフン
[バックスラッシュエスケープ]: characters.md#バックスラッシュエスケープ
[メイリオ]: https://ja.wikipedia.org/wiki/メイリオ
[リンク]: links.md
[打ち消し線]: #打ち消し線
[画像]: images.md
[斜体]: #斜体
[通常テキスト]: texts.md
[幅0の非表示区切り]: texts.md#幅0の非表示区切り
[太字]: #太字
[目次]: index.md#bold-italic-strikethrough
[文字参照]: characters.md#文字参照


<!-- ここから先は書きかけ

[GFM]: github-flavored-markdown.md
[スネークケース]: https://en.wikipedia.org/wiki/Snake_case
[バックスラッシュエスケープ]: characters.md#バックスラッシュエスケープ
[フォント]: https://ja.wikipedia.org/wiki/フォント


別のケースとして書式設定対象テキストが中間に`*`を含んでおり、そこで書式終了と認識される場合もエスケープを用いて対応する。次の文例は文字列全体を太字に設定しようとしたものだが、中間に`**`があるためそこで太字終了と認識されてしまう。

> &#x2714;&#xFE0F; [GFM]仕様では`*`は単語の中間にあっても強調文字と認識するが、`_`は認識しない。これはおそらくは[スネークケース]を考慮した仕様で...以下説明する。

```markdown
**AMERICAN F**TBALL**
```

> **AMERICAN F**TBALL**

このような場合は文内の`*`をエスケープすることで解決できる。この場合も[太字]のエスケープは中央部の`*`を両方エスケープする必要があることに注意すること。

```markdown
**AMERICAN F\*\*TBALL**
```

> **AMERICAN F\*\*TBALL**
-->

